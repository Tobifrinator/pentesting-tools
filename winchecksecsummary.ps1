echo "=====WINCHECKSEC RESULTS=====" > winchecksec_results.txt
$target_folder="PATH\TO\FOLDER\OF\PROGRAM"
$files = Get-ChildItem $target_folder"\*" -Recurse -Include "*.exe", "*.dll"
foreach ($file in $files)
{
	winchecksec $file >> winchecksec_results.txt
}

$sec_mechs = 'Dynamic Base','ASLR','High Entropy VA','Force Integrity','Isolation','NX','SEH','CFG','RFG','SafeSEH','GS','Authenticode','.NET'
echo "=====WINCHECKSEC SUMMARY===== " > winchecksec_report_summary.txt
"Target Folder: " +$target_folder >> winchecksec_report_summary.txt
"Evaluated DLLs: "+(Get-Content .\winchecksec_results.txt | select-string -pattern ".dll").length >> winchecksec_report_summary.txt
"Evaluated Executables: "+(Get-Content .\winchecksec_results.txt | select-string -pattern ".exe").length >> winchecksec_report_summary.txt
"Total:"+(Get-Content .\winchecksec_results.txt | select-string -pattern "Results for").length >> winchecksec_report_summary.txt
echo "" >> winchecksec_report_summary.txt
echo "" >> winchecksec_report_summary.txt
echo "# of missing protection measures:" >> winchecksec_report_summary.txt
foreach($sec_mech in $sec_mechs)
{
	$search_pattern="^"+$sec_mech+'(.*)"NotPresent"'
	" "+$sec_mech+": "+(Get-Content .\winchecksec_results.txt | select-string -pattern $search_pattern).length >> winchecksec_report_summary.txt
}
